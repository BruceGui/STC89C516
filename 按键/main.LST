C51 COMPILER V8.05a   MAIN                                                                 05/30/2013 15:35:06 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          #include "delay.h"
   4          
   5          /*sbit delayButton = P3^7;
   6          sbit sound = P2^0; */
   7          
   8          uchar keyValue;
   9          
  10          void keyScan();
  11          uint keyHandle();
  12          
  13          void main()
  14          {
  15   1              while(1)
  16   1              {
  17   2                      /*if(!delayButton)
  18   2                      {
  19   2                              delay(10);
  20   2                              while(!delayButton);
  21   2                              sound = 0;
  22   2                      }
  23   2                      sound = 1; */
  24   2                      keyScan();
  25   2                      P1 = ~keyHandle();
  26   2              }
  27   1      }
  28          
  29          void keyScan()
  30          {
  31   1              /*P3 = P3|0xF8;
  32   1              if((P3&0xF8) != 0xF8)
  33   1              {
  34   1                      //delay(10);
  35   1                      if((P3&0xF8) != 0xF8)
  36   1                      {
  37   1                              keyValue = P3&0xF8;
  38   1                      }
  39   1              }*/
  40   1      
  41   1              /*uchar readcode = 0x00;
  42   1              uchar scancode = 0x00;
  43   1      
  44   1              P3 = 0xF0;
  45   1              if((P3&0xF0) != 0xF0)
  46   1              {
  47   1                      delay(10);
  48   1                      P3 = 0xF0;
  49   1                      if((P3&0xF0) != 0xF0)
  50   1                      {
  51   1                              scancode = 0xFE;
  52   1                              while(scancode != 0xEF)
  53   1                              {
  54   1                                      P3 = scancode;
  55   1                                      if((P3&0xF0) != 0xF0)
C51 COMPILER V8.05a   MAIN                                                                 05/30/2013 15:35:06 PAGE 2   

  56   1                                      {
  57   1                                      //      while((P3&0xF0) != 0xF0);
  58   1                                              readcode = P3&0xF0;
  59   1                                              scancode = scancode&0x0F;
  60   1                                              keyValue = scancode + readcode;
  61   1                                              return ;
  62   1                                      }
  63   1                                      else
  64   1                                      {
  65   1                                              scancode = _crol_(scancode, 1);
  66   1                                      }
  67   1                              }
  68   1                      }
  69   1                      else
  70   1                      {
  71   1                              return ;
  72   1                      }
  73   1              }
  74   1              else
  75   1              {
  76   1                      return ;
  77   1              } 
  78   1      
  79   1              uchar h;
  80   1              uchar l;
  81   1      
  82   1              P3 = 0xF0;
  83   1              if((P3&0xF0) != 0xF0)
  84   1              {
  85   1                      delay(10);
  86   1                      if((P3&0xF0) != 0xF0)
  87   1                      {
  88   1                              h = P3&0xF0;
  89   1                              P3 = 0x0F;
  90   1                              l = P3&0x0F;
  91   1                              keyValue = h | l;       
  92   1                      }
  93   1              }*/
  94   1      
  95   1              uchar x,y; 
  96   1        P3=0xf0;                              //P3¸³Öµ0xf0
  97   1        if((P3&0xf0)!=0xf0)                   //ÅÐ¶Ï¸ß4Î»ÊÇ·ñÎªÈ«1£¨¸ß4Î»È«1´ú±íÃ»°´¼ü°´ÏÂ£©
  98   1      
  99   1          {
 100   2            delay(20);                        //ÑÓÊ±È¥¶¶¶¯£¬Ò»°ãÎª5ms¡«10ms£¨ÓÉÓÚ»úÐµ´¥µãµÄµ¯ÐÔ×÷ÓÃ£¬°´¼üÔÚ±ÕºÏÊ
             -±²»»áÂíÉÏÎÈ¶¨µØ½ÓÍ¨£¬
 101   2                                                  //¶øÔÚ±ÕºÏË²¼ä°éËæÓÐÒ»Á¬´®µÄ¶¶¶¯£¬¼ü¶¶¶¯»áÒýÆðÒ»´Î°´¼ü±»Îó¶Á¶à´Î£©
 102   2            if((P3&0xf0)!=0xf0)               //Èç¹û»¹ÄÜ¼ì²âµ½ÓÐ¼üÅÌ°´ÏÂÈ¥ 
 103   2              {
 104   3                        x=P3&0xf0;                    //¶ÁÈ¡P3¿ÚÊý¾Ý
 105   3                P3=0x0f;                      //·´×ª£¬P3¸³Öµ0x0f             
 106   3                y=P3&0x0f;                    //¶ÁÈ¡P3¿ÚÊý¾Ý
 107   3                keyValue=x|y;                 //µÃµ½É¨Ãè½á¹û
 108   3              }
 109   2          }
 110   1      }
 111          /*
 112          uchar keyScan()  
 113          {
 114            uchar scode=0x00;//É¨ÃèÂë
 115            uchar rcode=0x00;//¶Á»ØÂë
 116            
C51 COMPILER V8.05a   MAIN                                                                 05/30/2013 15:35:06 PAGE 3   

 117            P3=0xf0;
 118            if((P3&0xf0)!=0xf0)                   //ÅÐ¶Ï¸ß4Î»ÊÇ·ñÎªÈ«1£¨¸ß4Î»È«1´ú±íÃ»°´¼ü°´ÏÂ£©
 119          
 120              {
 121                delay(20);                        //ÑÓÊ±È¥¶¶¶¯£¬Ò»°ãÎª5ms¡«10ms£¨ÓÉÓÚ»úÐµ´¥µãµÄµ¯ÐÔ×÷ÓÃ£¬°´¼üÔÚ±ÕºÏÊ
             -±²»»áÂíÉÏÎÈ¶¨µØ½ÓÍ¨£¬
 122                                                      //¶øÔÚ±ÕºÏË²¼ä°éËæÓÐÒ»Á¬´®µÄ¶¶¶¯£¬¼ü¶¶¶¯»áÒýÆðÒ»´Î°´¼ü±»Îó¶Á¶à´Î£©
 123                P3=0xf0;
 124                if((P3&0xf0)!=0xf0)               //»¹ÄÜ¼ì²âµ½ÓÐ¼üÅÌ°´ÏÂÈ¥£¬°´ÐÐÉ¨Ãè
 125                  {
 126                           
 127                    scode=0xfe;                   //ÖÃÉ¨ÃèÂë
 128                    while(scode!=0xef)            //Èç¹ûÃ»ÓÐÉ¨ÃèÍê£¬¼ÌÐøÉ¨Ãè
 129                       {
 130                         P3=scode;                //ËÍÉ¨ÃèÂë
 131                         if((P3&0xf0)!=0xf0)      //¼ì²âµ½ÁË
 132                           {
 133                              rcode=P3;           //±£´æP3¿ÚµÄ×´Ì¬
 134                              rcode=rcode & 0xf0; //Éú³É·µ»ØÂë¸ß4Î»
 135                              scode=scode & 0x0f; //Éú³É·µ»ØÂëµÍ4Î»
 136                              keyValue=scode + rcode;//·µ»Ø¼üÅÌ±àÂë, ³ÌÐòÌø³ö¼üÅÌÉ¨Ãèº¯Êý£¨³ÌÐòÖ´ÐÐµ½returnÓï¾äµÄÊ±º
             -ò¾Í·µ»Ø£¬ËûºóÃæµÄÓï¾ä¶¼²»»áÖ´ÐÐ£©¡£
 137                                                  return keyValue;                                         
 138                           }
 139                         else
 140                           {
 141                             scode=(scode<<1)|0x01;//ÒÆÎ»£¬²úÉúÏÂÒ»ÐÐÉ¨ÃèÂë,Ë³Ðò£º0xfe>>0xfd>>0xfb>>0xf7>>0xef
 142                                             //scode = _crol(scode, 1)_
 143                                                                                       //µ±É¨ÃèÂëÎª0xefÊ±£¬ÅÐ¶ÏÌõ¼þscode!=0xeÎª¼Ù £¬Ìø³öwhile Ñ­»·
 144                           }
 145                                          
 146                       }
 147                     return(0);  //Ã»ÓÐ¼ì²âµ½·µ»Ø0
 148                  }
 149                else             //Ã»ÓÐ¼üÅÌ°´ÏÂÈ¥£¬ÉÏÒ»´ÎÊÇÒ»¸ö¸ÉÈÅ 
 150                  {
 151                   return(0);    //Ã»ÓÐ¼ì²âµ½·µ»Ø0
 152                  }
 153              }
 154            else  //Ã»ÓÐ¼üÅÌ°´ÏÂÈ¥
 155              {
 156               return(0);  //Ã»ÓÐ¼ì²âµ½·µ»Ø0
 157              }
 158          }*/
 159          
 160          uint keyHandle()
 161          {
 162   1              switch(keyValue)
 163   1              {
 164   2                      case 0xee:{return(0);break;}       //¶ÔÓ¦°´¼üS1
 165   2                 case 0xde:{return(1);break;}    //¶ÔÓ¦°´¼üS2 
 166   2                 case 0xbe:{return(2);break;}    //¶ÔÓ¦°´¼üS3 
 167   2                 case 0x7e:{return(3);break;}    //¶ÔÓ¦°´¼üS4 
 168   2                 case 0xed:{return(4);break;}    //¶ÔÓ¦°´¼üS5 
 169   2                 case 0xdd:{return(5);break;}    //¶ÔÓ¦°´¼üS6 
 170   2                 case 0xbd:{return(6);break;}    //¶ÔÓ¦°´¼üS7 
 171   2                 case 0x7d:{return(7);break;}    //¶ÔÓ¦°´¼üS8 
 172   2                 case 0xeb:{return(8);break;}    //¶ÔÓ¦°´¼üS9 
 173   2                 case 0xdb:{return(9);break;}    //¶ÔÓ¦°´¼üS10        
 174   2                 case 0xbb:{return(10);break;}   //¶ÔÓ¦°´¼üS11        
 175   2                 case 0x7b:{return(11);break;}   //¶ÔÓ¦°´¼üS12
 176   2                 case 0xe7:{return(12);break;}   //¶ÔÓ¦°´¼üS13        
C51 COMPILER V8.05a   MAIN                                                                 05/30/2013 15:35:06 PAGE 4   

 177   2                 case 0xd7:{return(13);break;}   //¶ÔÓ¦°´¼üS14        
 178   2                 case 0xb7:{return(14);break;}   //¶ÔÓ¦°´¼üS15        
 179   2                 case 0x77:{return(15);break;}   //¶ÔÓ¦°´¼üS16
 180   2                 default:{break;}     
 181   2              }
 182   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    190    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
